name: brk

services:
  brk:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: brk:latest
    container_name: brk
    restart: unless-stopped
    ports:
      - 7070:3110
    volumes:
      - ${BITCOIN_DATA_DIR:-/path/to/bitcoin}:/bitcoin:ro
      - ${BRK_DATA_VOLUME:-brk-data}:/home/brk/.brk
      # Bind mount alternative (uncomment and set BRK_DATA_DIR in .env):
      # - ${BRK_DATA_DIR:-./brk-data}:/home/brk/.brk
    command:
      - --bitcoindir
      - /bitcoin
      - --blocksdir
      - /bitcoin/blocks
      - --brkdir
      - /home/brk/.brk
      - --rpcconnect
      - "${BTC_RPC_HOST:-localhost}"
      - --rpcuser
      - "${BTC_RPC_USER:-bitcoin}"
      - --rpcpassword
      - "${BTC_RPC_PASSWORD:-bitcoin}"
      # Cookie file alternative (uncomment and remove rpcuser/rpcpassword above):
      # - --rpccookiefile
      # - /bitcoin/.cookie
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:3110/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  brk-data:
    driver: local
